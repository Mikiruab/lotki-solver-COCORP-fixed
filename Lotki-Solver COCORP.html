<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Lotki — Solver (logika 1 + tarcza 2)</title>
  <link href="https://fonts.googleapis.com/css2?family=Pricedown&display=swap" rel="stylesheet" />
  <!-- Original by Marichulanka edited by Klecha -->
  <!-- this file was made by klecha -->
  <!-- Marichulanka jak cos to mikiruab na kicku jestem -->
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #111;
      color: #fff;
      font-family: 'Pricedown', Impact, sans-serif;
      padding: 20px;
    }
    .container { max-width: 800px; margin: 0 auto; }
    .title {
      font-size: 2.6rem;
      margin: 25px 0;
      color: #FFD700;
      text-align: center;
      text-shadow: 0 0 10px rgba(255,215,0,0.5);
    }
    .dartboard-container { text-align: center; margin: 25px 0; }
    .dartboard-svg { width: 100%; max-width: 460px; cursor: pointer; }
    .result-box {
      background: #222; border: 1px solid #444; border-radius: 8px;
      padding: 20px; margin: 25px auto; max-width: 400px; text-align: center;
    }
    .result-label { font-size: 1.3rem; color: #FFD700; }
    .result-value { font-size: 1.8rem; margin-top: 4px; }
    .btn {
      background: #C9F158; color: #000; border: none;
      padding: 10px 22px; font-size: 1.15rem;
      cursor: pointer; border-radius: 4px; margin: 6px;
      transition: 0.2s;
    }
    .btn:hover { background: #b0d945; transform: scale(1.03); }
    .credits { margin-top: 30px; color: #aaa; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">Lotki — Solver</h1>

    <div class="dartboard-container" id="dartboardContainer"></div>

    <div class="result-box">
      <div class="result-label">Wynik:</div>
      <div class="result-value" id="resultValue">0</div>
    </div>

    <div style="text-align:center;">
      <button class="btn" id="resetBtn">Reset</button>
    </div>

    <div class="credits">
      made by <b>Marichulanka</b>, edited by <b>klecha</b>
    </div>
  </div>

<script>
/* -------------------- KONFIG -------------------- */

const colors = ["blue", "green", "red", "orange"];
const ops = ["+", "-", "*", "/"];
const dd = [20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5];

let bullseyeSquare = false;
let hasInteraction = false;

const Ft = 230;
const Vt = {
  bullseye: 12,
  innerBull: 20,
  ring1: 75,
  ring2: 90,
  ring3: 160,
  ring4: 175,
  numberRing: 230
};

/* -------------------- FUNKCJE SOLVERA -------------------- */

function apply(a, op, b) {
  if (op === "+") return a + b;
  if (op === "-") return a - b;
  if (op === "*") return a * b;
  if (op === "/") return b !== 0 ? a / b : null;
}

function permutations(arr) {
  if (arr.length === 1) return [arr];
  let res = [];
  for (let i = 0; i < arr.length; i++) {
    let rest = permutations(arr.slice(0, i).concat(arr.slice(i + 1)));
    for (let r of rest) res.push([arr[i], ...r]);
  }
  return res;
}

/* -------------------- RYSOWANIE TARCZY -------------------- */

function sectorPath(r1, r2, startDeg, endDeg, cx, cy) {
  const s = startDeg * Math.PI/180, e = endDeg * Math.PI/180;
  const large = (endDeg - startDeg > 180) ? 1 : 0;
  const x1 = cx + r1*Math.cos(s), y1 = cy + r1*Math.sin(s);
  const x2 = cx + r2*Math.cos(s), y2 = cy + r2*Math.sin(s);
  const x3 = cx + r2*Math.cos(e), y3 = cy + r2*Math.sin(e);
  const x4 = cx + r1*Math.cos(e), y4 = cy + r1*Math.sin(e);
  return `M ${x1} ${y1} L ${x2} ${y2} A ${r2} ${r2} 0 ${large} 1 ${x3} ${y3} L ${x4} ${y4} A ${r1} ${r1} 0 ${large} 0 ${x1} ${y1} Z`;
}

function buildDartboard() {
  const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
  svg.setAttribute("viewBox","0 0 460 460");
  svg.classList.add("dartboard-svg");

  const bg = document.createElementNS(svg.namespaceURI,"circle");
  bg.setAttribute("cx",Ft); bg.setAttribute("cy",Ft);
  bg.setAttribute("r",Vt.numberRing);
  bg.setAttribute("fill","#1a1a1a");
  svg.appendChild(bg);

  for (let i=0;i<20;i++){
    const a1 = i*18 - 99, a2 = a1+18;
    const even = i%2===0;

    const rings = [
      {r1:Vt.innerBull, r2:Vt.ring1, base:even?"#1a1a1a":"#f0f0e8", ring:2},
      {r1:Vt.ring1,     r2:Vt.ring2, base:even?"#3a3a3a":"#c8c0b0", ring:2},
      {r1:Vt.ring2,     r2:Vt.ring3, base:even?"#1a1a1a":"#f0f0e8", ring:3},
      {r1:Vt.ring3,     r2:Vt.ring4, base:even?"#3a3a3a":"#c8c0b0", ring:4}
    ];

    rings.forEach(r=>{
      const p=document.createElementNS(svg.namespaceURI,"path");
      p.setAttribute("d",sectorPath(r.r1,r.r2,a1,a2,Ft,Ft));
      p.setAttribute("fill",r.base);
      p.dataset.baseColor=r.base;
      p.dataset.color="none";
      p.dataset.ring=r.ring;
      p.dataset.number=dd[i];
      p.classList.add("segment");
      svg.appendChild(p);
    });

    const ang=(i*18-90)*Math.PI/180;
    const tx=Ft+(Vt.numberRing-25)*Math.cos(ang);
    const ty=Ft+(Vt.numberRing-25)*Math.sin(ang);
    const t=document.createElementNS(svg.namespaceURI,"text");
    t.setAttribute("x",tx); t.setAttribute("y",ty);
    t.setAttribute("fill","#f0f0e8");
    t.setAttribute("font-size","18");
    t.setAttribute("font-weight","bold");
    t.textContent=dd[i];
    svg.appendChild(t);
  }

  const inner=document.createElementNS(svg.namespaceURI,"circle");
  inner.setAttribute("cx",Ft); inner.setAttribute("cy",Ft);
  inner.setAttribute("r",Vt.innerBull);
  inner.setAttribute("fill","#73797a");
  inner.dataset.baseColor="#73797a";
  inner.dataset.color="none";
  inner.dataset.ring=1;
  inner.dataset.sectorType="innerBull";
  inner.classList.add("segment");
  svg.appendChild(inner);

  const bull=document.createElementNS(svg.namespaceURI,"rect");
  bull.setAttribute("x",Ft-Vt.bullseye);
  bull.setAttribute("y",Ft-Vt.bullseye);
  bull.setAttribute("width",Vt.bullseye*2);
  bull.setAttribute("height",Vt.bullseye*2);
  bull.setAttribute("fill","#8b1f2b");
  bull.setAttribute("rx",Vt.bullseye);
  bull.setAttribute("ry",Vt.bullseye);
  bull.dataset.baseColor="#8b1f2b";
  bull.dataset.color="none";
  bull.dataset.ring=0;
  bull.dataset.sectorType="bullseye";
  bull.classList.add("segment");
  svg.appendChild(bull);

  document.getElementById("dartboardContainer").appendChild(svg);

  document.querySelectorAll(".segment").forEach(s=>{
    s.addEventListener("click",onSegmentClick);
  });
}

/* -------------------- KLIKANIE -------------------- */

function cycleColor(el){
  let c=el.dataset.color;

  // none → blue
  if(c==="none"){
    el.dataset.color="blue";
    el.setAttribute("fill","blue");
    return;
  }

  let idx=colors.indexOf(c);

  // jeśli orange → wracamy do none
  if(c==="orange"){
    el.dataset.color="none";
    el.setAttribute("fill",el.dataset.baseColor);
    return;
  }

  // normalny cykl
  const next=colors[(idx+1)%colors.length];
  el.dataset.color=next;
  el.setAttribute("fill",next);
}

function onSegmentClick(e){
  const el=e.currentTarget;
  hasInteraction=true;

  if(el.dataset.sectorType==="bullseye"){
    bullseyeSquare=!bullseyeSquare;
    el.setAttribute("rx",bullseyeSquare?0:Vt.bullseye);
    el.setAttribute("ry",bullseyeSquare?0:Vt.bullseye);
    compute();
    return;
  }

  cycleColor(el);
  compute();
}

/* -------------------- ZBIERANIE DANYCH -------------------- */

function collectRings(){
  const seg=[...document.querySelectorAll(".segment")];
  const arr=[];
  seg.forEach(s=>{
    const ring=parseInt(s.dataset.ring);
    const type=s.dataset.sectorType||"number";
    let val=0;
    if(type==="innerBull") val=25;
    else if(type==="bullseye") val=50;
    else val=parseInt(s.dataset.number);

    arr.push({ring,val,color:s.dataset.color});
  });
  arr.sort((a,b)=>a.ring-b.ring);
  return arr;
}

/* -------------------- OBLICZENIA -------------------- */

function compute(){
  if(!hasInteraction){
    document.getElementById("resultValue").textContent=0;
    return;
  }

  const rings=collectRings();

  const anyColored=rings.some(r=>r.color!=="none");
  if(!anyColored){
    document.getElementById("resultValue").textContent=0;
    return;
  }

  const vals=rings.map(r=>r.val);
  const cols=rings.map(r=>r.color);

  const perms=permutations(ops);
  let valid=null;

  outer:
  for(let perm of perms){
    let map={};
    colors.forEach((c,i)=>map[c]=perm[i]);

    for(let dir of ["OUT→IN","IN→OUT"]){
      let order=[...vals.keys()];
      if(dir==="OUT→IN") order.sort((a,b)=>rings[b].ring-rings[a].ring);
      else order.sort((a,b)=>rings[a].ring-rings[b].ring);

      let v=0;
      for(let i=0;i<order.length;i++){
        let idx=order[i];
        if(cols[idx]==="none") continue;
        v=apply(v,map[cols[idx]],vals[idx]);
        if(v===null || !Number.isInteger(v)) continue outer;
      }
      valid={map,dir};
      break outer;
    }
  }

  let result=0;
  if(valid){
    let order=[...vals.keys()];
    if(valid.dir==="OUT→IN") order.sort((a,b)=>rings[b].ring-rings[a].ring);
    else order.sort((a,b)=>rings[a].ring-rings[b].ring);

    for(let idx of order){
      if(cols[idx]==="none") continue;
      result=apply(result,valid.map[cols[idx]],vals[idx]);
    }
    if(bullseyeSquare) result=result*result;
  }

  document.getElementById("resultValue").textContent=result;
}

/* -------------------- RESET -------------------- */

function resetBoard(){
  document.querySelectorAll(".segment").forEach(s=>{
    s.dataset.color="none";
    s.setAttribute("fill",s.dataset.baseColor);
    if(s.dataset.sectorType==="bullseye"){
      s.setAttribute("rx",Vt.bullseye);
      s.setAttribute("ry",Vt.bullseye);
    }
  });
  bullseyeSquare=false;
  hasInteraction=false;
  document.getElementById("resultValue").textContent=0;
}

/* -------------------- START -------------------- */

document.addEventListener("DOMContentLoaded",()=>{
  buildDartboard();
  document.getElementById("resetBtn").addEventListener("click",resetBoard);
});
</script>

</body>
</html>
